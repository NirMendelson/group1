{% extends 'base.html' %}

{% block title %}
<title>פרופיל</title>
{% endblock %}

{% block css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/base.css') }}">
<link rel="stylesheet" href="{{ url_for('signup.static', filename='css/signup.css') }}">
<link rel="stylesheet" href="{{ url_for('profile.static', filename='css/profile.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/header.css') }}">
{% endblock %}

{% block content %}
<div class="scrollable-container">
    <div class="form-container">
        <h1>פרופיל</h1>
        <form id="profile-form">
            <div class="form-row">
                <div class="form-group">
                    <label for="email">אימייל</label>
                    <input type="email" id="email" value="{{ customer['email'] }}" disabled />
                </div>
                <div class="form-group">
                    <label for="name">שם</label>
                    <input type="text" id="name" value="{{ customer['name'] }}" />
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="phone">מספר טלפון</label>
                    <input type="tel" id="phone" value="{{ customer['phone'] }}" />
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="city">עיר</label>
                    <input type="text" id="city" value="{{ customer['address']['city'] }}" />
                </div>
                <div class="form-group">
                    <label for="street">רחוב</label>
                    <input type="text" id="street" value="{{ customer['address']['street'] }}" />
                </div>
                <div class="form-group">
                    <label for="number">מספר</label>
                    <input type="text" id="number" value="{{ customer['address']['number'] }}" />
                </div>
            </div>
            <div class="form-row">
                <div class="form-group full-width">
                    <label for="supermarket">סופר מועדף</label>
                    <select id="supermarket">
                        <option value="">בחר סופר</option>
                        {% for supermarket in supermarkets %}
                        <option value="{{ supermarket }}" {% if customer['supermarket'] == supermarket %}selected{% endif %}>
                            {{ supermarket }}
                        </option>
                        {% endfor %}
                    </select>
                </div>
            </div>
            <div class="delete-and-action-btns">
                <button type="button" class="delete-btn">מחק משתמש</button>
                <button type="submit" class="action-btn">עדכן</button>
            </div>
            <div id="error-message" class="error-message"></div>
            <div id="success-message" class="success-message"></div>
        </form>
    </div>

    <!-- Active Order Section -->
    <div class="form-container">
        <h2>הזמנה פעילה</h2>
        {% if active_order %}
        <p>
            תאריך:
            {{
                active_order['date'].split('-')[2] ~ '.' ~
                active_order['date'].split('-')[1] ~ '.' ~
                active_order['date'].split('-')[0]
            }}
        </p>
        <p>שעה: {{ active_order['time'] }}</p>
        <p>סופר: {{ active_order['supermarket'] }}</p>

        {% if can_cancel %}
        <!-- Show cancel button if more than 24h remain -->
        <button class="delete-order-btn" data-order-id="{{ active_order['_id'] }}">
            בטל הזמנה
        </button>
        {% else %}
        <!-- Otherwise show the message -->
        <p>ניתן לבטל הזמנה עד 24 שעות לפני</p>
        {% endif %}

        {% else %}
        <p>לא קיימת הזמנה פעילה</p>
        {% endif %}
    </div>

    <!-- Past Orders Section -->
    <div class="form-container">
        <h2>הזמנות עבר</h2>
        {% if past_orders and past_orders|length > 0 %}
            {% for order in past_orders %}
            <div class="past-order">
                <p>
                    תאריך:
                    {{
                        order['date'].split('-')[2] ~ '.' ~
                        order['date'].split('-')[1] ~ '.' ~
                        order['date'].split('-')[0]
                    }}
                </p>
                <p>שעה: {{ order['time'] }}</p>
                <p>סופר: {{ order['supermarket'] }}</p>
            </div>
            {% endfor %}
        {% else %}
        <p>לא קיימות הזמנות עבר</p>
        {% endif %}
    </div>
</div>

<script src="{{ url_for('profile.static', filename='js/profile.js') }}"></script>
{% endblock %}
